const path = require('path');

const TemplateBase = require('../templateBase');
const { OPTION_JAVA_MVN, OPTION_JAVA_PACKAGE, URLS } = require('../../constants');


module.exports = class NodeJSTemplate extends TemplateBase {
    constructor(projectPath, generator) {
        super(projectPath, generator, __dirname);
    }

    getPriority() {
        return Number.MAX_VALUE;
    }

    async checkEnabled() { //NOSONAR
        if (this.options[OPTION_JAVA_PACKAGE]) {
            this.logger.warn(`[cds] Specified Java package will be ignored since project type is not Java. Use --add java to create project type Java.`);
        }
        if (this.options[OPTION_JAVA_MVN]) {
            this.logger.warn(`[cds] Specified Maven parameters will be ignored since project type is not Java. Use --add java to create project type Java.`);
        }

        return true;
    }

    async run() {
        const env = await this.getEnv();

        const values = {
            projectName: this.projectName
        }
        await this.templateUtil.copyFiles('.', this.projectPath, values, this.options.force);

        const dbFolderPath = path.join(this.projectPath, env.folders.db);
        await this.fsUtil.mkdirp(dbFolderPath);

        const srvFolderPath = path.join(this.projectPath, env.folders.srv);
        await this.fsUtil.mkdirp(srvFolderPath);

        const appFolderPath = path.join(this.projectPath, env.folders.app);
        await this.fsUtil.mkdirp(appFolderPath);

        // used to call npm install here
    }

    async finalize() {
        const relativeProjectPath = path.relative(this.cwd, this.projectPath);
        if (relativeProjectPath && relativeProjectPath !== '.') {
            this.logger.log(`Continue with 'cd ${relativeProjectPath}'`);
        }

        this.logger.log(`Find samples on ${URLS.SAMPLES}`);
        this.logger.log(`Learn about next steps at ${URLS.CAPIRE}`);
    }
}
